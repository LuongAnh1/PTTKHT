<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Forgot Password - Fashion Store Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1967d2",
                        "primary-dark": "#1557b0",
                        "background-light": "#f6f7f8",
                        "background-dark": "#111921",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                },
            },
        }
    </script>
</head>

<body
    class="font-display bg-gray-100 text-[#111418] min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
    <div class="absolute inset-0 w-full h-full z-0">
        <div class="absolute inset-0 bg-cover bg-center"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuDcCU3JAgZs8RPD0ky3J-ILW181DR-pvX_Owz0jz1xGh_sM984xOdsLUunzRLpDBWmWHjd0baP-zUVpjMHSpagdN3vrQ6YzJuA7O-6Kvsw8fcsPjIQEoHg2vSD_X5hccWty5khaHQMdrU2zY7AOEw-heORHj9qN0sYy2hPdd-W7lbubV1UYzntdvYHZ_D4nQavHfkDPtk817I-MJqxiCbuVdA8JOQNH_YHI_K2wV2re-6CkVfZSlRgPVFeIF8S4dmDx0CbNp0_MbwM');">
        </div>
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-md"></div>
    </div>
    <div
        class="relative z-10 w-full max-w-[900px] h-auto min-h-[550px] bg-white rounded-2xl shadow-2xl flex flex-col lg:flex-row overflow-hidden">
        
        <!-- Left Side -->
        <div
            class="w-full lg:w-1/2 bg-gradient-to-br from-blue-700 to-[#001a4d] p-8 lg:p-12 flex flex-col justify-between text-white relative">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-[28px]">settings</span>
                <span class="font-bold text-lg tracking-wide">Quản lý cửa hàng</span>
            </div>
            <div class="flex-1 flex items-center justify-center relative my-8 lg:my-0">
                <div class="absolute w-48 h-48 bg-blue-400/20 rounded-full blur-3xl"></div>
                <div class="relative">
                    <span
                        class="material-symbols-outlined text-[120px] lg:text-[150px] text-blue-100 drop-shadow-2xl">lock_reset</span>
                    <span
                        class="material-symbols-outlined text-[40px] text-blue-300 absolute -top-2 -right-6 animate-bounce"
                        style="animation-duration: 3s;">mail</span>
                </div>
            </div>
            <div>
                <h2 class="text-2xl lg:text-3xl font-bold mb-3 leading-tight">Khôi phục quyền truy cập</h2>
                <p class="text-blue-100/90 text-sm lg:text-base leading-relaxed">
                    Xác minh danh tính của bạn qua email để thiết lập lại mật khẩu.
                </p>
            </div>
        </div>

        <!-- Right Side -->
        <div class="w-full lg:w-1/2 bg-white p-8 lg:p-12 flex flex-col relative">
            
            <!-- BUTTON VỀ ĐĂNG NHẬP -->
            <a href="../DN/code.html"
                class="absolute top-5 right-5 w-10 h-10 flex items-center justify-center rounded-full bg-gray-50 text-gray-500 hover:bg-red-50 hover:text-red-600 transition-all shadow-sm hover:shadow-md border border-transparent hover:border-red-100"
                title="Thoát về đăng nhập">
                <!-- Icon Close (Dấu X) -->
                <span class="material-symbols-outlined text-[24px]">close</span>
            </a>

            <div class="my-auto w-full max-w-sm mx-auto pt-6 lg:pt-0">
                <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-2">Quên mật khẩu</h1>
                <p class="text-sm text-gray-500 mb-8">Nhập thông tin để đặt lại mật khẩu của bạn.</p>
                <form id="forgotPasswordForm" class="flex flex-col gap-5">
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-semibold text-gray-700" for="username">
                            Tên đăng nhập
                        </label>
                        <input
                            class="form-input w-full rounded-lg border border-gray-300 bg-white focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-gray-400 h-11 px-4 text-sm transition-all shadow-sm"
                            id="username" name="username" placeholder="Nhập tên đăng nhập" type="text" required />
                    </div>

                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-semibold text-gray-700" for="email">
                            Email xác nhận
                        </label>
                        <input
                            class="form-input w-full rounded-lg border border-gray-300 bg-white focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-gray-400 h-11 px-4 text-sm transition-all shadow-sm"
                            id="email" name="email" placeholder="Nhập email của bạn" type="email" required />
                    </div>

                    <!-- Mật khẩu mới -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-semibold text-gray-700" for="new-password">
                            Mật khẩu mới
                        </label>
                        <div class="relative w-full">
                            <input
                                class="form-input w-full rounded-lg border border-gray-300 bg-white focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-gray-400 h-11 pl-4 pr-10 text-sm transition-all shadow-sm"
                                id="new-password" name="newPassword" placeholder="Nhập mật khẩu mới" type="password"
                                required />
                            <!-- Đã cập nhật onclick gọi hàm togglePassword -->
                            <button
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 cursor-pointer"
                                type="button"
                                onclick="togglePassword('new-password', this)">
                                <span class="material-symbols-outlined text-[20px]">visibility_off</span>
                            </button>
                        </div>
                    </div>

                    <!-- Nhập lại mật khẩu -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-semibold text-gray-700" for="confirm-password">
                            Nhập lại mật khẩu mới
                        </label>
                        <div class="relative w-full">
                            <input
                                class="form-input w-full rounded-lg border border-gray-300 bg-white focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-gray-400 h-11 pl-4 pr-10 text-sm transition-all shadow-sm"
                                id="confirm-password" name="confirmPassword" placeholder="Nhập lại mật khẩu mới"
                                type="password" required />
                             <!-- Đã cập nhật onclick gọi hàm togglePassword -->
                            <button
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 cursor-pointer"
                                type="button"
                                onclick="togglePassword('confirm-password', this)">
                                <span class="material-symbols-outlined text-[20px]">visibility_off</span>
                            </button>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full rounded-full bg-primary hover:bg-blue-600 text-white font-bold h-11 mt-4 shadow-md hover:shadow-lg transition-all transform active:scale-[0.98]">
                        Đặt lại mật khẩu
                    </button>
                </form>

                <script>
                    // 1. HÀM CHUYỂN ĐỔI ICON MẮT (MỚI)
                    function togglePassword(inputId, btn) {
                        const input = document.getElementById(inputId);
                        const icon = btn.querySelector('span'); // Tìm thẻ span icon bên trong nút bấm

                        if (input.type === "password") {
                            input.type = "text";
                            // Chuyển sang icon mắt mở (visibility)
                            icon.innerText = "visibility"; 
                        } else {
                            input.type = "password";
                            // Chuyển sang icon mắt gạch chéo (visibility_off)
                            icon.innerText = "visibility_off"; 
                        }
                    }

                    // 2. XỬ LÝ SUBMIT FORM
                    document.getElementById('forgotPasswordForm').addEventListener('submit', async function (e) {
                        e.preventDefault();

                        const username = document.getElementById('username').value;
                        const email = document.getElementById('email').value;
                        const newPassword = document.getElementById('new-password').value;
                        const confirmPassword = document.getElementById('confirm-password').value;

                        if (newPassword !== confirmPassword) {
                            alert('Mật khẩu nhập lại không trùng khớp!');
                            return;
                        }

                        const btn = this.querySelector('button[type="submit"]');
                        const originalText = btn.innerHTML;

                        // Loading state
                        btn.disabled = true;
                        btn.innerHTML = '<span class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"></span> Đang xử lý...';

                        try {
                            const response = await fetch('/api/forget-password', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    username: username,
                                    email: email,
                                    newPassword: newPassword
                                })
                            });

                            const data = await response.json();

                            if (data.success) {
                                alert('Đặt lại mật khẩu thành công! Vui lòng đăng nhập.');
                                window.location.href = '../DN/code.html';
                            } else {
                                alert(data.message || 'Đặt lại mật khẩu thất bại.');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Lỗi kết nối server.');
                        } finally {
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                        }
                    });
                </script>
            </div>
            <div class="mt-8 text-center lg:hidden">
                <p class="text-xs text-gray-400">© 2024 Fashion Store Manager</p>
            </div>
        </div>
    </div>
</body>

</html>